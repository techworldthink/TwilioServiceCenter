{% extends 'admin/admin_base.html' %}

{% block title %}System Monitoring{% endblock %}
{% block page_title %}System Monitoring{% endblock %}

{% block content %}
<!-- System Statistics -->
<div class="admin-stats-grid">
    <div class="admin-stat-card">
        <div class="admin-stat-label">Total Clients</div>
        <div class="admin-stat-value">{{ stats.total_clients }}</div>
    </div>

    <div class="admin-stat-card">
        <div class="admin-stat-label">Active Clients</div>
        <div class="admin-stat-value">{{ stats.active_clients }}</div>
    </div>

    <div class="admin-stat-card">
        <div class="admin-stat-label">Total API Keys</div>
        <div class="admin-stat-value">{{ stats.total_api_keys }}</div>
    </div>

    <div class="admin-stat-card">
        <div class="admin-stat-label">Active API Keys</div>
        <div class="admin-stat-value">{{ stats.active_api_keys }}</div>
    </div>
</div>

<!-- Detailed Stats -->
<div
    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
    <!-- Top Clients by Balance -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h3 class="admin-card-title">Top Clients by Balance</h3>
        </div>
        <div class="admin-card-body">
            {% if top_clients %}
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for client in top_clients %}
                        <tr>
                            <td>{{ client.name }}</td>
                            <td>
                                <span class="admin-badge admin-badge-success">
                                    ${{ client.balance|floatformat:2 }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p style="color: var(--admin-text-muted); text-align: center; padding: 2rem;">No data available</p>
            {% endif %}
        </div>
    </div>

    <!-- Clients by API Keys -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h3 class="admin-card-title">Clients by API Keys</h3>
        </div>
        <div class="admin-card-body">
            {% if clients_by_keys %}
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>API Keys</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for client in clients_by_keys %}
                        <tr>
                            <td>{{ client.name }}</td>
                            <td>
                                <span class="admin-badge admin-badge-info">
                                    {{ client.keys_count }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p style="color: var(--admin-text-muted); text-align: center; padding: 2rem;">No data available</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- System Info -->
<div class="admin-card" style="margin-top: 1.5rem;">
    <div class="admin-card-header">
        <h3 class="admin-card-title">System Information</h3>
    </div>
    <div class="admin-card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
            <div>
                <div style="font-size: 0.875rem; color: var(--admin-text-muted); margin-bottom: 0.5rem;">
                    Total Balance Pool
                </div>
                <div style="font-size: 1.5rem; font-weight: 600; color: var(--admin-success);">
                    ${{ stats.total_balance|floatformat:2 }}
                </div>
            </div>

            <div>
                <div style="font-size: 0.875rem; color: var(--admin-text-muted); margin-bottom: 0.5rem;">
                    Twilio Accounts
                </div>
                <div style="font-size: 1.5rem; font-weight: 600; color: var(--admin-info);">
                    {{ stats.total_twilio_accounts }}
                </div>
            </div>

            <div>
                <div style="font-size: 0.875rem; color: var(--admin-text-muted); margin-bottom: 0.5rem;">
                    Routing Rules
                </div>
                <div style="font-size: 1.5rem; font-weight: 600; color: var(--admin-warning);">
                    {{ stats.total_routing_rules }}
                </div>
            </div>

            <div>
                <div style="font-size: 0.875rem; color: var(--admin-text-muted); margin-bottom: 0.5rem;">
                    Revoked API Keys
                </div>
                <div style="font-size: 1.5rem; font-weight: 600; color: var(--admin-danger);">
                    {{ stats.revoked_api_keys }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}